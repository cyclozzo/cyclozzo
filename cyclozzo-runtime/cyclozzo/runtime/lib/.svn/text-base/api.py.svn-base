#! /usr/bin/env python
# RESTful api client for Cyclozzo
# @author: Sreejith K

from cyclozzo.runtime.lib.restful_lib import Connection
import json

class ClientException(Exception):
	pass

def decode(data):
	return json.loads(data)

class Client(Connection):
	
	def __init__(self, server='127.0.0.1', port=8080):
		base_url = 'http://%s:%d/api' %(server, port)
		Connection.__init__(self, base_url)
	
	def execute(self, action=None, args=None):
		result = self.request_get(action, args)
		headers = result['headers']
		if headers['status'] == '200' and headers['content-type'] == 'application/json':
			return decode(result['body'])
		else:
			raise ClientException